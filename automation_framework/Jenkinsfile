pipeline {
	agent {
		label 'java'
	}

	stages {
		stage("Build") {
			tools {
				gradle 'gradle4.10.2'
			}
			steps {
				sh 'echo Building with gradle'
				sh 'gradle -b automation_framework/build.gradle test check build'
			}
			post {
				always {
					sh 'touch automation_framework/build/test-results/test/*.xml'
					junit allowEmptyResults: true, testResults: '**/build/test-results/test/*.xml'
				}
			}
		}
		stage("Analysis") {
			steps {
				sh 'touch automation_framework/build/test-results/test/*.xml'
				junit allowEmptyResults: true, testResults: '**/build/test-results/test/*.xml'
				findbugs canComputeNew: false, defaultEncoding: '', excludePattern: '', healthy: '', includePattern: '', pattern: '**/build/reports/findbugs/*.xml', unHealthy: ''
				jacoco classDirectories = fileTree(dir: "${project.buildDir}/classes/main")
				sh 'sloccount --duplicates --wide --details ./ > sloccount.sc'
				sloccountPublish encoding: '', pattern: ''
				archiveArtifacts artifacts: '**/*.jar', excludes: '**/jacocoagent.jar', onlyIfSuccessful: true
			}
			post {
				always {
					cleanWs()
				}
			}
		}
	}
}
